---
title: 'Results'
author: Wikum Dinalankara
geometry: margin=.7cm
header-includes:
   - \usepackage{tabularx, longtable, graphicx, csquotes, hyperref, color}
output:
  html_document:
    toc: true
    number_sections: true
---
```{r opts, echo = FALSE}
knitr::opts_chunk$set(
  dev = "png",
  fig.path = "fig/"
)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.process = function(x) {
  x2 = sub('-\\d+([.][a-z]+)$', '\\1', x)
  if (file.rename(x, x2)) x2 else x
})
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}

set.seed(1)

library(knitr)
library(ggplot2)
library(gridExtra)
library(grid)
library(cowplot)
library(rutils)
library(tidyr)
library(gplots)
library(ggrepel)
library(reshape2)
library(RColorBrewer)
require(switchBox)
require(Biobase)
require(limma)
require(pROC)
require(caret)
require(reshape)
require(plotROC)
library(enrichR)
library(mltools)
library(xtable)
library(boot)
library(patchwork)

```


# Cross-Mechanism runs

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

l1 = load("../Objs/list.data.rda")
l2 = load("../Objs/list.mech.rda")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

df = data.frame(Reduce(rbind, utils.lapply_i(list.data, function(x, i, y){
  
  u = levels(as.factor(x$trainGroup))
  
  c(
    y,
    nrow(x$trainMat),
    length(x$trainGroup),
    length(x$testGroup),
    u[1],
    u[2],
    sum(x$trainGroup == u[1]),
    sum(x$trainGroup == u[2]),
    sum(x$testGroup == u[1]),
    sum(x$testGroup == u[2])
  )
  
})))
colnames(df) = c("Problem", "genes", "n train", "n test", "class 1", "class 2", "train class 1", "train class 2",
                 "test class 1", "test class 2")

kable(df, row.names=FALSE, caption="Problem stats")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

df = data.frame(Reduce(rbind, utils.lapply_i(list.mech, function(x, i, y){
  
  c(y, nrow(x), length(unique(as.vector(x))))
  
})))
colnames(df) = c("mechanism", "pairs", "genes")

kable(df, row.names=FALSE, caption="Mechanistic pair sets")

```



## KTSP

For a given set of mechanistic pairs:

* Take all mechanistic pairs available in the given dataset
* No statistical filtering used (no Wilcoxon test applied in KTSP training)
* krange $=25$, so the classifier will attempt to add upto 25 pairs

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}


l3 = load("../Objs/list.run.ktsp.2.rda")

```



```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run$Bladder, caption="Bladder")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run$Breast, caption="Breast")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run$Prostate, caption="Prostate")

```

## RF

### Gene level

For a given set of mechanistic pairs:

* Take all mechanistic pairs available in the given dataset, take the genes forming these pairs
* Take the gene expression data for these genes and supply them for random forest training and testing
* parameters: `mtryStart = 1, ntreeTry=500, stepFactor = 1, improve=0.05`

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}


l4 = load("../Objs/list.run.rf.2.rda")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.genes$Bladder, caption="Bladder")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.genes$Breast, caption="Breast")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.genes$Prostate, caption="Prostate")

```

### Pair level

For a given set of mechanistic pairs:

* Take all mechanistic pairs available in the given dataset, take the genes forming these pairs
* Use these pairs to train a KTSP classifier with no statistical filtering; allow upto 25 pairs to be selected (i.e. `krange=25`)
* For the pairs, compute binary votes using `SWAP.KTSP.Statistics` for both training and testing data.
* Train and test random forest with the binary votes; parameters: `mtryStart = 1, ntreeTry=500, stepFactor = 1, improve=0.05`

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.pairs$Bladder, caption="Bladder")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.pairs$Breast, caption="Breast")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.pairs$Prostate, caption="Prostate")

```



## SVM

### Gene level

For a given set of mechanistic pairs:

* Take all mechanistic pairs available in the given dataset, take the genes forming these pairs
* Take the gene expression data for these genes and supply them for SVM training and testing
* parameters: polynomial SVM with `degree = 3, scale = 0.01, C = 0.25`

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}


l4 = load("../Objs/list.run.svm.rda")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.genes$Bladder, caption="Bladder")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.genes$Breast, caption="Breast")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.genes$Prostate, caption="Prostate")

```

### Pair level

For a given set of mechanistic pairs:

* Take all mechanistic pairs available in the given dataset, take the genes forming these pairs
* Use these pairs to train a KTSP classifier with no statistical filtering (except for "GO" mechanism where top 500 DE genes are selected); allow upto 50 pairs to be selected (i.e. `krange=50`)
* For the pairs, compute binary votes using `SWAP.KTSP.Statistics` for both training and testing data.
* Train and test SVM with the binary votes; polynomial SVM with `degree = 3, scale = 0.01, C = 0.25`

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.pairs$Bladder, caption="Bladder")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.pairs$Breast, caption="Breast")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.pairs$Prostate, caption="Prostate")

```


## XGB

### Gene level

For a given set of mechanistic pairs:

* Take all mechanistic pairs available in the given dataset, take the genes forming these pairs
* Take the gene expression data for these genes and supply them for XGB training and testing
* For training, split the data into training vs validation ($70\%$ vs. $30\%$)
* parameters: `nrounds = 500, early_stopping_rounds = 50` and other general XBG parameters

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}


l5 = load("../Objs/list.run.xgb.2.rda")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.genes$Bladder, caption="Bladder")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.genes$Breast, caption="Breast")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.genes$Prostate, caption="Prostate")

```

### Pair level

For a given set of mechanistic pairs:

* Take all mechanistic pairs available in the given dataset, take the genes forming these pairs
* Use these pairs to train a KTSP classifier with no statistical filtering; allow upto 25 pairs to be selected (i.e. `krange=25`)
* For the pairs, compute binary votes using `SWAP.KTSP.Statistics` for both training and testing data.
* For training, split the data into training vs validation ($70\%$ vs. $30\%$)
* parameters: `nrounds = 500, early_stopping_rounds = 50` and other general XBG parameters


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.pairs$Bladder, caption="Bladder")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.pairs$Breast, caption="Breast")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6}

kable(list.run.pairs$Prostate, caption="Prostate")

```


